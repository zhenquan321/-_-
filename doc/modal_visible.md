# 模态弹窗和模态层与返回路由的关系

## 一. 问题阐述
在开发WebAPP的时候，常常会有一种困惑，就是当一个页面中有一个模态弹窗正处于开启状态，这时候用户按下返回键，浏览器/webview会返回到上一个页面/路由,但是弹窗却没有关闭，这不是我们想要的。

参考原生APP的设计, 我们理想的状态是这样的：用户按下返回键时，如果模态弹窗或者模态层处于关闭状态，就关闭模态弹窗或者模态层，且不返回上一个页面/路由

## 二. 问题分析
其实用户在按下返回键的时候是希望弹窗关闭的，但是由于浏览器/webview的特点, 按下返回键就相当于执行了`this.$router.back()`操作, 并且这个过程不会对弹窗做任何操作, 所以弹窗也就不会关闭了

## 三. 解决思路
解决思路其实很简单, 我们对返回操作做一层代理, 也就是说先拦截返回操作, 如果这时候存在模态窗或者模态层处于打开状态，那么就关闭它;如果不存在, 则对浏览器/webview执行真正的返回操作。

当然, 一个WebAPP中的模态弹窗和模态层与可能很多, 我们需要对他们进行统一管理, 我在这里使用栈的思想来管理他们, 给处于开启状态的模态弹窗和模态层设置不同的优先级, 优先级高的先关闭, 优先级低的后关闭, 怎么实现呢?一个数组就可以模拟栈了, so easy ~

## 四. 项目中的模态弹窗或者模态层
- 左侧用户中心 'user-center'
    * 关于弹窗 'about'
    * 反馈建议弹窗 'feedback'
- 全屏幕播放器 'player'
    * 下载弹窗 'download'
- 播放列表弹出层 'play-list'
    * 清空列表弹窗 'clear-play-list'
- 首页登录注册提示框 'login-or-register'
- 清除搜索记录弹窗 'clear-search-history'
